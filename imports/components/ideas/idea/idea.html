<div class="VST-view-container">

    <!-- Idea header -->

    <section class="VST-view-header row">
        <div class="logo-wrapper">
            <img src="/images/icon-Idea.png" alt="Idea main icon" />
            <h1>idea</h1>
        </div>
        <header>
            <!-- Project path -->
            <div class="project-path">
                <h3 id="project">{{$ctrl.idea.projectName()}}<span class="project-badge">v</span>Vesta</h3>
                <h3 id="module">{{$ctrl.idea.moduleName()}}</h3>
                <h3>Klasa</h3>
            </div>
            <!-- Buttons -->
            <div class="buttons">
                <!-- Create new task -->
                <new-task title="Create task" module="{{$ctrl.idea.module}}"
                          project="{{$ctrl.idea.projectId}}"></new-task>
                <!-- Button trigger modal -->
                <button type="button" class="btn-V btn-V-default"
                        data-toggle="modal" data-target="#deleteIdeaModal">
                    <span class="glyphicon glyphicon-trash"></span>
                </button>

                <!-- DELETE Modal -->
                <div class="modal fade" id="deleteIdeaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModalLabel">Remove Idea</h4>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to remove this idea ?
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" ng-click="$ctrl.removeIdea()">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </section>

    <!-- Idea description -->

    <section class="VST-view-content row">
        <header>
            <p>Title:</p>
            <h4>[{{$ctrl.idea.number}}] {{$ctrl.idea.title}}
                <!-- Idea status -->
                <div class="idea-status-wrapper dropdown">
                    <button class="idea-status idea-status-Rejected dropdown-toggle" type="button"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">rejected</button>
                    <ul class="dropdown-menu">
                        <li class="idea-status idea-status-New">new</li>
                        <li class="idea-status idea-status-Consider">conside</li>
                        <li class="idea-status idea-status-Implemented">implemented</li>
                        <li class="idea-status idea-status-Rejected">rejected</li>
                    </ul>
                </div>
            </h4>
            <div class="VST-view-addDate">05.05.2016</div>
        </header>
        <!-- Description wrapper -->
        <div class="VST-view-desc-wrapper">
            <!-- Buttons -->
            <div class="btn-group-desc" ng-switch="$ctrl.descriptionEdited">
                <button type="button" name="button" class="btn-edit"
                        ng-switch-when="false" ng-click="$ctrl.editDescription()">
                    <span class="glyphicon glyphicon-pencil"></span>
                </button>
                <button type="button" name="button" class="btn-save"
                        ng-switch-when="true" ng-click="$ctrl.saveDescription()">
                    <span class="glyphicon glyphicon-floppy-disk"></span>
                </button>
            </div>
            <!-- Description -->
            <div text-angular ng-model="$ctrl.idea.description"
                 ta-disabled="!$ctrl.descriptionEdited" class="description"></div>
            <!-- Reviewers -->
            <div class="info-box">
                <pill ng-repeat="reviewer in $ctrl.reviewers"
                      value="reviewer"
                      read-only="!$ctrl.descriptionEdited"></pill>
                <select ng-model="$ctrl.reviewer"
                        ng-change="$ctrl.reviewerSelected()"
                        ng-options="user.profile.fullname for user in
                                        $ctrl.users"
                        ng-hide="$ctrl.users.length < 1">
                </select>
            </div>
        </div>
    </section>

    <!-- Idea Reviews -->
    <section class="idea-reviews row">
        <div class="reviews-wrapper">
            <h2>Reviews</h2>

            <!-- New review box -->
            <div class="new-review-box" ng-if="$ctrl.newReviewVisible()">
                <div class="new-review-content-box">
                    <h3 class="col-xs-9">{{$ctrl.currentUserName()}}</h3>
                    <div class="prons-cons-wrapper">
                        
                        <!-- PROS -->
                        <div class="prons-box">
                            <form action="" ng-submit="$ctrl.addMerit()">
                                <input placeholder="+&nbsp;prons"
                                       ng-model="$ctrl.merit"/>
                            </form>
                            <pill state="plus" value="merit"
                                ng-repeat="merit in $ctrl.review.merits"
                                remove="$ctrl.removeMerit(merit)">
                            </pill>
                        </div>
                        
                        <!-- CONS -->
                        <div class="cons-box">
                            <form action="" ng-submit="$ctrl.addDrawback()">
                                <input placeholder="-&nbsp;prons"
                                       ng-model="$ctrl.drawback"/>
                            </form>
                            <pill state="minus" value="drawback"
                                  ng-repeat="drawback in $ctrl.review.drawbacks"
                                  remove="$ctrl.removeDrawback(drawback)">
                            </pill>
                        </div>
                    </div>
                    
                    <!-- DESCRIPTION -->
                    <textarea placeholder="Add description here..."
                              ng-model="$ctrl.review.comment"
                              class="desc-wrapper"></textarea>
                    <button class="btn btn-default" ng-click="$ctrl.addReview()">
                        Add
                    </button>
                </div>
            </div>

            <!-- Added rewiews -->
            <div class="reviews-added-wrapper">
                <!-- Review box -->
                <div class="review-box"  ng-repeat="review in $ctrl.reviews track by $index">
                    <div class="btn-group-desc">
                        <!-- EDIT -->
                        <button  ng-if="$ctrl.currentUserIsReviewOwner(review) && 
                                        !review.edited"
                                 ng-click="review.edited = true">
                            <span class="glyphicon glyphicon-pencil"></span>
                        </button>
                        <!-- SAVE -->
                        <button ng-if="$ctrl.ownerAndEdit(review)"
                                ng-click="$ctrl.updateReview(review)">
                            <span class="glyphicon glyphicon-floppy-disk"></span>
                        </button>                   
                    </div>
                    <div class="review-content-box">
                        <header>
                            <h3>{{review.creator()}}
                                <!-- REMOVE -->
                                <button class="btn-V btn-V-cancel"
                                        ng-click="$ctrl.removeReview(review._id)"
                                        ng-if="$ctrl.currentUserIsReviewOwner(review)">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </button>
                            </h3>
                            <p class="review-addTime">
                                {{$ctrl.moment(review.createdAt).fromNow()}}
                            </p>
                        </header>
                        <div class="prons-cons-wrapper">
                            <div class="prons-box">
                                <form action="" ng-submit="$ctrl.addMerit(review)"
                                      ng-if="$ctrl.ownerAndEdit(review)">
                                    <input placeholder="+&nbsp;prons"
                                        ng-model="$ctrl.merit"/>
                                </form>
                                <pill state="plus" value="merit"
                                      ng-repeat="merit in review.merits"
                                      remove="$ctrl.removeMerit(merit, review)"
                                      read-only="!$ctrl.ownerAndEdit(review)">
                                </pill>
                            </div>
                            <div class="cons-box">
                                <form action="" ng-submit="$ctrl.addDrawback(review)"
                                      ng-if="$ctrl.ownerAndEdit(review)">
                                    <input placeholder="-&nbsp;prons"
                                        ng-model="$ctrl.drawback"/>
                                </form>
                                <pill state="minus" value="drawback"
                                      ng-repeat="drawback in review.drawbacks"
                                      remove="$ctrl.removeDrawback(drawback, review)"
                                      read-only="!$ctrl.ownerAndEdit(review)">
                                </pill>
                            </div>
                        </div>
                        <div class="desc-wrapper" ng-switch="!!review.edited">
                            <p ng-switch-when="false">
                                {{review.comment}}
                            </p>
                            <textarea ng-switch-when="true"
                                      placeholder="Add description here..."
                                      ng-model="review.comment"
                                      class="desc-wrapper">
                            </textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
