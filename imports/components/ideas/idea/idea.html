<div class="VST-view-container VST-idea-container">

    <!-- Idea header -->

    <section class="VST-view-header">
        <div class="logo-wrapper">
            <img src="/images/icon-Idea.png" alt="Idea main icon" />
            <h1 class="idea-color">idea</h1>
        </div>
        <header>


        </header>
    </section>

    <!-- Idea description -->
    <section class="VST-view-content">
        <section class="VST-view-desc">
            <!-- Number -->
            <div class="VST-view-number">
                <span class="VST-module-id">#{{$ctrl.idea.id}}</span>
                <span class="VST-module-date"><span>creted at</span> {{$ctrl.idea.creationDate | date: 'dd.MM.yy'}}</span>
            </div>

            <!-- Project path -->
            <div class="VST-view-project-path">
                <h3 id="project"><span class="project-badge">v</span>{{$ctrl.idea.projectName()}}</h3>
                <h3 id="module">{{$ctrl.idea.moduleName()}}</h3>
            </div>

            <header>
                <p>Title:</p>
                <h4>[{{$ctrl.idea.number}}] {{$ctrl.idea.title}}</h4>
            </header>

            <!-- Description wrapper -->
            <div class="VST-view-desc-wrapper">
                <!-- Buttons -->
                <div class="btn-group-desc" ng-switch="$ctrl.descriptionEdited">
                    <button type="button" name="button" class="btn-edit" ng-switch-when="false" ng-click="$ctrl.editDescription()">
                        <span class="glyphicon glyphicon-pencil"></span>
                    </button>
                    <button type="button" name="button" class="btn-save" ng-switch-when="true" ng-click="$ctrl.saveDescription()">
                        <span class="glyphicon glyphicon-floppy-disk"></span>
                    </button>
                </div>
                <!-- Description -->
                <div text-angular ng-model="$ctrl.idea.description" ta-disabled="!$ctrl.descriptionEdited" class="description" ta-toolbar="[['h1','h2','h3','pre'],['bold','italics', 'underline', 'strikeThrough', 'ul', 'ol', 'clear'],['html', 'insertImage', 'insertLink']]"></div>
            </div>
            <!-- Buttons -->
            <div class="buttons">
                <div class="VST-btn-group VST-btn-group-menu">
                    <!-- Button trigger modal -->
                    <button type="button" class="VST-btn" ng-if="$ctrl.idea.status === 'Deferred'" ng-click="$ctrl.setStatus('Consider')">
                            <span class="glyphicon glyphicon-repeat"></span>
                            Reopen
                    </button>

                    <!-- Button trigger modal -->
                    <button type="button" class="VST-btn" ng-if="$ctrl.changeStatusBtnsVisibility('Reject')" data-toggle="modal" data-target="#rejectIdeaModal">
                            <span class="glyphicon glyphicon-remove"></span>
                            Reject
                    </button>

                    <!-- Reject Modal -->
                    <div class="modal fade" id="rejectIdeaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">Are you sure you want to reject the Idea ?</h4>
                                </div>
                                <div class="modal-body">
                                    <textarea cols="30" rows="10" placeholder="Add Reason here..." ng-model="$ctrl.reason"></textarea>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="$ctrl.reason = ''">Cancel</button>
                                    <button type="button" class="btn btn-danger" ng-click="$ctrl.setStatus('Rejected')" data-dismiss="modal">
                                        Reject
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="VST-btn" ng-if="$ctrl.changeStatusBtnsVisibility('Defer')" data-toggle="modal" data-target="#deferIdeaModal"
                        type="button">
                        <span class="glyphicon glyphicon-hourglass"></span>
                        Defer
                    </button>
                    <!-- Defer Modal -->
                    <div class="modal fade" id="deferIdeaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">Are you sure you want to defer the Idea ?</h4>
                                </div>
                                <div class="modal-body">
                                    <textarea cols="30" rows="10" placeholder="Add Reason here..." ng-model="$ctrl.reason"></textarea>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="$ctrl.reason = ''">Cancel</button>
                                    <button type="button" class="btn btn-warning" ng-click="$ctrl.setStatus('Deferred')" data-dismiss="modal">
                                        Defer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="VST-btn" ng-if="$ctrl.changeStatusBtnsVisibility('Close')" data-toggle="modal" data-target="#closeIdeaModal"
                        type="button">
                        Close
                    </button>
                    <!-- Close Modal -->
                    <div class="modal fade" id="closeIdeaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">Close Idea</h4>
                                </div>
                                <div class="modal-body">
                                    Are you sure you want to close this idea ?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                    <button type="button" class="btn btn-success" ng-click="$ctrl.setStatus('Closed')" data-dismiss="modal">
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="VST-btn-group VST-btn-group-create">
                    <!-- Create New Task -->
                    <new-task title="Create task"
                        parent-module="{{$ctrl.idea.module}}"
                        parent-project="{{$ctrl.idea.project}}"
                        parent-title="{{$ctrl.idea.title}}"
                        parent-sprint="$ctrl.idea.sprint"
                        idea-id="{{$ctrl.idea._id}}" alt-id="0"
                        ng-if="$ctrl.idea.status === 'Working' ||
                            $ctrl.idea.status === 'Consider' ||
                            $ctrl.idea.status === 'Implemented' ||
                            $ctrl.idea.status === 'Discussed'">
                    </new-task>

                    <!-- Create New Idea -->
                    <new-idea title="Sub-Idea" module="{{$ctrl.idea.module}}" project="{{$ctrl.idea.project}}" idea-id="{{$ctrl.idea._id}}" idea-title="{{$ctrl.idea.title}}"
                        alt-id="0" sprint="$ctrl.idea.sprint" reviewers="$ctrl.idea.reviewers">
                    </new-idea>

                    <!-- Create New Ask -->
                    <new-ask module="{{$ctrl.idea.module}}" project="{{$ctrl.idea.project}}" idea-id="{{$ctrl.idea._id}}" idea-title="{{$ctrl.idea.title}}"
                        sprint="$ctrl.idea.sprint" alt-id="0" ng-if="$ctrl.idea.status === 'Consider'">
                    </new-ask>
                </div>
            </div>
        </section>

        <!-- Info box -->
        <section class="VST-view-info-box">
            <!-- Idea status -->
            <div class="idea-status idea-status-{{$ctrl.idea.status}}" type="button">
                {{$ctrl.idea.status}}
            </div>
            <!-- Reviewers -->
            <div class="reviewers-box">
                <pill ng-repeat="reviewer in $ctrl.reviewers" value="reviewer" read-only="!$ctrl.descriptionEdited"></pill>
                <select ng-model="$ctrl.reviewer" ng-change="$ctrl.reviewerSelected()" ng-options="user.profile.fullname for user in
                                    $ctrl.users" ng-hide="$ctrl.users.length < 1">
                </select>
            </div>
            <p>
                Creator: {{$ctrl.idea.creator()}}
            </p>
            <p>
                Sprint {{$ctrl.idea.sprint}}
            </p>

            <!--Sprint-->
            <fieldset id="sprint" class="field-wrapper">
                <label class="label-modal">Sprint:</label>
                <select ng-model="$ctrl.sprint" name="sprint" ng-options="sprint as sprint for sprint in $ctrl.project.sprints" ng-change="$ctrl.setSprint()">
                </select>
            </fieldset>

            <!-- Button trigger modal -->
            <button type="button" class="VST-btn VST-btn-default" data-toggle="modal" data-target="#deleteIdeaModal">
                <span class="glyphicon glyphicon-trash"></span>
            </button>

            <!-- DELETE Modal -->
            <div class="modal fade" id="deleteIdeaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Remove Idea</h4>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to remove this idea ?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" ng-click="$ctrl.removeIdea()">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </section>

    <!-- Related -->
    <div class="VST-table-wrapper">
        <table class="table">
            <thead>
                <tr ng-if="$ctrl.relatedTasks.length + $ctrl.asks.length + $ctrl.relatedIdeas.length > 0">
                    <th></th>
                    <th>Relation</th>
                    <th>Number</th>
                    <th>Title</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="task in $ctrl.relatedTasks">
                    <td>
                        <a href="#/task/{{task.number}}">
                            <span class="module-badge module-badge-task">
                                <img src="/images/icon-Task-small.png" alt="Task main icon" />
                            </span>
                        </a>
                    </td>
                    <td><a href="#/task/{{task.number}}">{{task.relation}}</a></td>
                    <td><a href="#/task/{{task.number}}">{{task.number}}</a></td>
                    <td><a href="#/task/{{task.number}}">{{task.title}}</a></td>
                    <td><a href="#/task/{{task.number}}">{{task.status}}</a></td>
                </tr>  
                 <tr ng-repeat="ask in $ctrl.relatedAsks">
                    <td>
                        <a href="#/ask/{{ask.number}}">
                            <span class="module-badge module-badge-ask">
                                <img src="/images/icon-Ask-small.png" alt="Ask main icon" />
                            </span>
                        </a>
                    </td>
                    <td><a href="#/ask/{{ask.number}}">{{ask.relation}}</a></td>
                    <td><a href="#/ask/{{ask.number}}">{{ask.number}}</a></td>
                    <td><a href="#/ask/{{ask.number}}">{{ask.title}}</a></td>
                    <td><a href="#/ask/{{ask.number}}">{{ask.status}}</a></td>
                </tr>
                <tr ng-repeat="idea in $ctrl.relatedIdeas">
                    <td>
                        <a href="#/idea/{{idea.number}}">
                            <span class="module-badge module-badge-idea">
                                <img src="/images/icon-Idea-small.png" alt="Idea main icon" />
                            </span>
                        </a>
                    </td>
                    <td><a href="#/idea/{{idea.number}}">{{idea.relation}}</a></td>
                    <td><a href="#/idea/{{idea.number}}">{{idea.number}}</a></td>
                    <td><a href="#/idea/{{idea.number}}">{{idea.title}}</a></td>
                    <td><a href="#/idea/{{idea.number}}">{{idea.status}}</a></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Idea Reviews -->
    <ng-include src="'imports/components/ideas/idea/review.html'"></ng-include>
</div>
