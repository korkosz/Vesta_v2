<div class="VST-view-container">

    <!-- Idea header -->

    <section class="VST-view-header row">
        <div class="logo-wrapper">
            <img src="/images/icon-Idea.png" alt="Idea main icon" />
            <h1>idea <span class="VST-module-id">#{{$ctrl.idea.id}}</span></h1>
        </div>
        <header>
            <!-- Project path -->
            <div class="project-path">
                <h3 id="project">{{$ctrl.idea.projectName()}}<span class="project-badge">v</span>Vesta</h3>
                <h3 id="module">{{$ctrl.idea.moduleName()}}</h3>
            </div>
            <!-- Buttons -->
            <div class="buttons">
                
                <button class="btn btn-danger"
                    ng-if="$ctrl.changeStatusBtnsVisibility('Reject')"
                    ng-click="$ctrl.setStatus('Rejected')">
                    <span class="glyphicon glyphicon-remove"></span>
                    Reject
                </button>
                <button class="btn btn-warning"
                    ng-if="$ctrl.changeStatusBtnsVisibility('Defer')"
                    ng-click="$ctrl.setStatus('Deferred')">
                    <span class="glyphicon glyphicon-share-alt"></span>Defer
                </button>
                <button class="btn btn-success"
                    ng-if="$ctrl.changeStatusBtnsVisibility('Close')"
                    ng-click="$ctrl.setStatus('Closed')">
                    Close
                </button>
                <!-- Create new task -->
                <new-task title="Create task" module="{{$ctrl.idea.module}}"
                          project="{{$ctrl.idea.projectId}}" idea-id="{{$ctrl.idea._id}}"
                          idea-title="{{$ctrl.idea.title}}" alt-id="0">
                </new-task>
                
                <!-- Button trigger modal -->
                <button type="button" class="VST-btn VST-btn-default"
                        data-toggle="modal" data-target="#deleteIdeaModal">
                    <span class="glyphicon glyphicon-trash"></span>
                </button>

                <!-- DELETE Modal -->
                <div class="modal fade" id="deleteIdeaModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModalLabel">Remove Idea</h4>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to remove this idea ?
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" ng-click="$ctrl.removeIdea()">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </section>

    <!-- Idea description -->

    <section class="VST-view-content row">
        <header>
            <p>Title:</p>
            <h4>[{{$ctrl.idea.number}}] {{$ctrl.idea.title}}
                <!-- Idea status -->
                <div class="idea-status-wrapper dropdown">
                    <button class="idea-status idea-status-{{$ctrl.idea.status}}
                                   dropdown-toggle"
                            type="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="true">
                            {{$ctrl.idea.status}}
                    </button>
                    <ul class="dropdown-menu">
                        <li class="idea-status idea-status-New"
                            ng-click="$ctrl.setStatus('New')"><span class="glyphicon glyphicon-leaf"></span>new</li>
                        <li class="idea-status idea-status-Considered"
                            ng-click="$ctrl.setStatus('Considered')"><span class="glyphicon glyphicon-flash"></span>consider</li>
                        <li class="idea-status idea-status-Working"
                            ng-click="$ctrl.setStatus('Working')"><span class="glyphicon glyphicon-refresh"></span>working</li>
                        <li class="idea-status idea-status-Implemented"
                            ng-click="$ctrl.setStatus('Implemented')"><span class="glyphicon glyphicon-ok"></span>implemented</li>
                        <li class="idea-status idea-status-Rejected"
                            ><span class="glyphicon glyphicon-remove"></span>rejected</li>
                        <li class="idea-status idea-status-Deferred"
                            ><span class="glyphicon glyphicon-share-alt"></span>deferred</li>
                    </ul>
                </div>
            </h4>
            <div class="VST-view-addDate">{{$ctrl.idea.creationDate | date: 'dd.MM.yy'}}</div>
        </header>
        <!-- Description wrapper -->
        <div class="VST-view-desc-wrapper">
            <!-- Buttons -->
            <div class="btn-group-desc" ng-switch="$ctrl.descriptionEdited">
                <button type="button" name="button" class="btn-edit"
                        ng-switch-when="false" ng-click="$ctrl.editDescription()">
                    <span class="glyphicon glyphicon-pencil"></span>
                </button>
                <button type="button" name="button" class="btn-save"
                        ng-switch-when="true" ng-click="$ctrl.saveDescription()">
                    <span class="glyphicon glyphicon-floppy-disk"></span>
                </button>
            </div>
            <!-- Description -->
            <div text-angular ng-model="$ctrl.idea.description"
                 ta-disabled="!$ctrl.descriptionEdited" class="description" ta-toolbar="[['h1','h2','h3','pre'],['bold','italics', 'underline', 'strikeThrough', 'ul', 'ol', 'clear'],['html', 'insertImage', 'insertLink']]"></div>
            <!-- Reviewers -->
            <div class="info-box">
                <div class="reviewers-box">
                    <pill ng-repeat="reviewer in $ctrl.reviewers"
                          value="reviewer"
                          read-only="!$ctrl.descriptionEdited"></pill>
                    <select ng-model="$ctrl.reviewer"
                            ng-change="$ctrl.reviewerSelected()"
                            ng-options="user.profile.fullname for user in
                                        $ctrl.users"
                            ng-hide="$ctrl.users.length < 1">
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Related Tasks -->
    <div class="VST-table-wrapper">
        <table class="table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Assigned</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="task in $ctrl.tasks"
                    ng-click="$ctrl.taskDetails(task.number)"
                    style="cursor: pointer;">
                    <td>{{task.title}}</td>
                    <td data-toggle="tooltip"
                        title="{{task.assignedUser()}}">
                        {{task.assignedUserShort()}}
                    </td>
                    <td>{{task.status}}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Idea Reviews -->
    <ng-include src="'imports/components/ideas/idea/review.html'"></ng-include>
</div>
